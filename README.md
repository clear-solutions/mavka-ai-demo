# Mavka AI Code Review

Welcome to the **Mavka AI Code Review** project!  
This repository demonstrates the functionality of the [Mavka AI Code Review tool](https://mavka.ai/), showcasing how it analyzes code, detects bugs, and assists developers in improving code quality.

## Main Goal

The main goal of this project is to illustrate the power and precision of the Mavka AI Code Review tool by providing real-world examples of bugs and code issues that the tool can detect. The project reviews actual code changes and highlights the feedback generated by Mavka AI so users can clearly understand the types of problems it can catch.

## Bugs Detected by Mavka AI

### Business Logic Bugs

#### Example 1.

This project demonstrates a subtle bug in a Spring Boot REST API implementation.  
**Bug:** When updating a user, the application allows the username in the request body to differ from the username in the URL path, potentially causing data inconsistency.

**Example**
```http
PUT /users/alice
{
  "username": "bob",
  "email": "bob@example.com",
  "fullName": "Bob Smith"
}
```
In this scenario, the user with the key "alice" is updated, but the stored object now has username "bob".

[See the full code here.](https://github.com/clear-solutions/mavka-ai-demo/pull/2#discussion_r2203430755)

### Java Multithreading Bugs

#### Example 1.
The `createUser` endpoint uses a non-atomic check-then-put sequence (`containsKey` followed by `put`) when adding a new user. This can lead to a race condition if two concurrent requests try to create the same username: both may pass the `containsKey` check and both insert, resulting in duplicate users and an incorrect `CREATED` response for the second request.

**Example**
```http
# Two clients send at the same time:
POST /users
{
  "username": "alice",
  "email": "alice@example.com",
  "fullName": "Alice Smith"
}
```
Both requests might succeed, even though only one user should be created.

**Solution:**  
Use `ConcurrentHashMap.putIfAbsent` to atomically check and insert:
```java
User existing = userStorage.putIfAbsent(user.getUsername(), user);
if (existing != null) {
    return new ResponseEntity<>("User already exists", HttpStatus.CONFLICT);
}
```

[See the full code here.](https://github.com/clear-solutions/mavka-ai-demo/pull/2/files#r2203430754)


### java Serialization Bugs
#### Example 1.
## Subtle Serialization Bug Example
The `User` class is declared as a non-static inner class inside `UserController`. Because of this, Jackson (the JSON library used by Spring Boot) cannot deserialize incoming JSON into a `User` instance, since it requires an implicit reference to the outer `UserController` object. This results in deserialization failures at runtime when trying to create or update users.

**Example**
```http
POST /users
{
  "username": "alice",
  "email": "alice@example.com",
  "fullName": "Alice Smith"
}
```
This request will fail with a deserialization error because Jackson cannot instantiate the non-static inner class.

**Solution:**  
Declare the `User` class as `static`, or move it to its own top-level file:
```java
public static class User { ... }
```

[See the full code here.](https://github.com/clear-solutions/mavka-ai-demo/pull/2/files#r2203430746)


## Learn More
- [Mavka AI Website](https://mavka.ai/)
- [Mavka AI Demo Repository](https://github.com/clear-solutions/mavka-ai-demo)
